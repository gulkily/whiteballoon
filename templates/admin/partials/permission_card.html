{% if not permission_summary %}
  <div class="permission-card permission-card--empty">
    <p class="muted small-text">Permission data unavailable.</p>
  </div>
{% else %}
  {% set peer_attr = permission_summary.peer_auth_attribute %}
  {% set updated_by = permission_summary.peer_auth_updated_by_user %}
  <div class="permission-card stack" data-permission-card>
    <header class="permission-card__header">
      <span class="muted small-text">Permission summary</span>
      <div class="permission-card__chips">
        <span class="permission-chip permission-chip--{{ 'admin' if permission_summary.is_admin else 'member' }}">
          {{ 'Admin' if permission_summary.is_admin else 'Member' }}
        </span>
        <span class="permission-chip permission-chip--{{ 'active' if permission_summary.peer_auth_reviewer else 'muted' }}">
          {{ 'Peer reviewer' if permission_summary.peer_auth_reviewer else 'Not reviewer' }}
        </span>
      </div>
    </header>
    <div class="permission-card__body">
      <dl class="permission-card__list">
        <div class="permission-card__row">
          <dt>Role</dt>
          <dd>{{ 'Administrator' if permission_summary.is_admin else 'Member' }}</dd>
        </div>
        <div class="permission-card__row">
          <dt>Peer-auth reviewer</dt>
          <dd>
            {{ 'Enabled' if permission_summary.peer_auth_reviewer else 'Disabled' }}
            {% if permission_summary.peer_auth_reviewer_via_admin %}
              <span class="muted small-text">Admins inherit peer review access automatically.</span>
            {% elif peer_attr and peer_attr.updated_at %}
              <span class="muted small-text">
                Updated {{ peer_attr.updated_at | friendly_time }}
                {% if updated_by %}
                  by
                  {% include "partials/display_name.html" with
                    username=updated_by.username,
                    display_name=updated_by.display_name,
                    href='/admin/profiles/' ~ updated_by.id,
                    class_name='profile-name-link'
                  %}
                {% elif peer_attr.updated_by_user_id %}
                  by user #{{ peer_attr.updated_by_user_id }}
                {% endif %}
              </span>
            {% else %}
              <span class="muted small-text">No reviewer history recorded.</span>
            {% endif %}
          </dd>
        </div>
      </dl>
      <div class="permission-card__actions" data-permission-actions>
        <form method="post" action="/admin/profiles/{{ profile.id }}/permissions" class="permission-card__form">
          <input type="hidden" name="next" value="{{ current_url }}" />
          <input type="hidden" name="action" value="{{ 'revoke_admin' if permission_summary.is_admin else 'grant_admin' }}" />
          <button type="submit" class="button button--secondary button--small">
            {{ 'Remove admin access' if permission_summary.is_admin else 'Grant admin access' }}
          </button>
        </form>
        {% if permission_summary.peer_auth_reviewer_via_admin %}
          <p class="muted small-text">Remove admin access to revoke peer review privileges.</p>
        {% else %}
          <form method="post" action="/admin/profiles/{{ profile.id }}/permissions" class="permission-card__form">
            <input type="hidden" name="next" value="{{ current_url }}" />
            <input type="hidden" name="action" value="{{ 'peer_auth_disable' if permission_summary.peer_auth_reviewer else 'peer_auth_enable' }}" />
            <button type="submit" class="button button--ghost button--small">
              {{ 'Disable peer reviewer' if permission_summary.peer_auth_reviewer else 'Enable peer reviewer' }}
            </button>
          </form>
        {% endif %}
      </div>
    </div>
  </div>
{% endif %}
