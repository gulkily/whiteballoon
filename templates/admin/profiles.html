{% extends "base.html" %}

{% block title %}Admin · Profiles · WhiteBalloon{% endblock %}

{% block nav %}
  {% include "partials/account_nav.html" %}
{% endblock %}

{% block content %}
<section class="section stack" data-page="admin-profiles">
  <header class="stack">
    <p class="muted small-text">Admin-only</p>
    <h1>Profiles</h1>
    <p class="muted">Review everyone on this instance at a glance.</p>
  </header>

  <div class="card stack" data-section="profiles-directory">
    <form method="get" class="profiles-filter">
      <input type="hidden" name="page" value="1" />
      <label class="stack" for="profiles-username">
        <span>Username</span>
        <input
          id="profiles-username"
          type="text"
          name="username"
          value="{{ username_query }}"
          placeholder="e.g., aurora"
        />
      </label>
      <label class="stack" for="profiles-contact">
        <span>Contact email</span>
        <input
          id="profiles-contact"
          type="text"
          name="contact"
          value="{{ contact_query }}"
          placeholder="name@example.org"
        />
      </label>
      <div class="profiles-filter__actions">
        <button type="submit" class="button button--secondary">Apply filters</button>
        {% if filters_active %}
          <a class="button button--ghost" href="{{ clear_filters_url }}">Clear</a>
        {% endif %}
      </div>
    </form>

    {% if profiles %}
      <div class="table-scroll">
        <table class="profiles-table">
          <thead>
            <tr>
              <th scope="col">Username</th>
              <th scope="col">Contact</th>
              <th scope="col">Joined</th>
              <th scope="col">Scope</th>
              <th scope="col">Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for profile in profiles %}
              <tr>
                <td data-label="Username">
                  <strong>@{{ profile.username }}</strong>
                  <p class="muted small-text">ID #{{ profile.id }}</p>
                </td>
                <td data-label="Contact">
                  {% if profile.contact_email %}
                    <a href="mailto:{{ profile.contact_email }}" class="profile-contact">{{ profile.contact_email }}</a>
                  {% else %}
                    <span class="muted">—</span>
                  {% endif %}
                </td>
                <td data-label="Joined">
                  {% if profile.created_at %}
                    <time datetime="{{ profile.created_at }}">{{ profile.created_at | friendly_time }}</time>
                  {% else %}
                    <span class="muted">Unknown</span>
                  {% endif %}
                </td>
                <td data-label="Scope">
                  <span class="meta-chip meta-chip--status meta-chip--{{ 'success' if profile.sync_scope == 'public' else 'muted' }}">
                    <span class="meta-chip__label">Sharing</span>
                    <span class="meta-chip__value">{{ 'Public' if profile.sync_scope == 'public' else 'Private' }}</span>
                  </span>
                </td>
                <td data-label="Actions">
                  <div class="profiles-actions">
                    <a href="/people/{{ profile.username }}" class="profile-action">View profile</a>
                    <span class="profile-action profile-action--placeholder">Invite history (coming soon)</span>
                  </div>
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      <div class="profiles-pagination">
        <p class="muted small-text">Showing page {{ page }} of {{ total_pages }} · {{ profiles_total }} total</p>
        <div class="profiles-pagination__actions">
          {% if pagination.has_prev %}
            <a class="button button--ghost" href="{{ pagination.prev_url }}">Previous</a>
          {% else %}
            <span class="button button--ghost button--disabled" aria-disabled="true">Previous</span>
          {% endif %}
          {% if pagination.has_next %}
            <a class="button button--ghost" href="{{ pagination.next_url }}">Next</a>
          {% else %}
            <span class="button button--ghost button--disabled" aria-disabled="true">Next</span>
          {% endif %}
        </div>
      </div>
    {% else %}
      <p class="muted">{{ 'No profiles match these filters.' if filters_active else 'No profiles found yet.' }}</p>
    {% endif %}
  </div>
</section>
{% endblock %}
