{% set session = session if session is defined else None %}
{% set session_role = session_role if session_role is defined else None %}
{% set avatar_url = session_avatar_url if session_avatar_url is defined else None %}
{% set show_admin = user.is_admin %}
{% set show_half_auth = session and (not session.is_fully_authenticated) %}
{% set show_nav_status_tags = show_nav_status_tags if show_nav_status_tags is defined else (feature_nav_status_tags | default(True)) %}
{% set primary_links = [
  {"label": "Requests", "href": "/requests/channels", "icon": "partials/icons/nav_requests.svg"},
  {"label": "Comments", "href": "/browse?tab=comments", "icon": "partials/icons/nav_comments.svg"},
  {"label": "Browse", "href": "/browse", "icon": "partials/icons/nav_browse.svg"},
  {"label": "Menu", "href": "/menu", "icon": "partials/icons/nav_menu.svg"},
] %}
<div class="account-nav">
  <nav class="account-nav__primary" aria-label="Primary">
    {% for link in primary_links %}
      <a class="account-nav__link" href="{{ link.href }}">
        <span class="account-nav__link-icon">{% include link.icon %}</span>
        <span class="account-nav__link-label">{{ link.label }}</span>
      </a>
    {% endfor %}
  </nav>
  <div class="account-nav__utility">
    {% if session_role %}
      {% if show_admin %}
        <a class="account-status__tag account-status__tag--role account-status__tag--link" href="/admin" data-session-role>
          Admin
        </a>
      {% elif show_nav_status_tags %}
        <span class="account-status__tag account-status__tag--role" data-session-role>{{ session_role.label }}</span>
      {% endif %}
    {% endif %}
    {% if show_half_auth and show_nav_status_tags %}
      <span class="account-status__tag account-status__tag--half" title="Complete verification to unlock full access">Half-auth</span>
    {% endif %}
    <div class="account-nav__peer-alert" data-peer-auth-notice hidden>
      <a
        class="account-status__tag account-status__tag--half account-status__tag--link"
        href="/peer-auth"
        data-peer-auth-link
        title="Review pending login approvals"
      >
        Review logins
      </a>
      <span class="account-nav__peer-count" data-peer-auth-count aria-live="polite" aria-label="0 pending logins"></span>
    </div>
    <a class="account-nav__user" href="/profile">
      <span class="account-nav__avatar" aria-hidden="true">
        {% if avatar_url %}
          <img src="{{ avatar_url }}" alt="" />
        {% else %}
          <span class="account-nav__avatar-initials">{{ user.username[:2] | upper }}</span>
        {% endif %}
      </span>
      <span class="account-nav__name">@{{ user.username }}</span>
    </a>
  </div>
</div>
