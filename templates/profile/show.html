{% extends "base.html" %}

{% block title %}{{ person.username }} · Profile · WhiteBalloon{% endblock %}

{% block nav %}
  {% include "partials/account_nav.html" %}
{% endblock %}

{% block content %}
<section class="section stack">
  <header class="profile-header">
    <div class="profile-avatar" aria-hidden="true">
      {% if identity.avatar_url %}
        <img src="{{ identity.avatar_url }}" alt="" />
      {% else %}
        <span class="profile-avatar__initials">{{ identity.username[:2] | upper }}</span>
      {% endif %}
    </div>
    <div class="profile-header__body">
      <h1>{{ person.username }}</h1>
      {% if is_self %}
        <p class="muted">This is your profile as seen by other members.</p>
      {% else %}
        <p class="muted">Community profile visible to members with sign-in access.</p>
      {% endif %}
    </div>
  </header>

  <article class="card stack">
    <h2>Account details</h2>
    <dl class="definition-list">
      <div class="definition-list__row">
        <dt>Username</dt>
        <dd>{{ identity.username }}</dd>
      </div>
      <div class="definition-list__row">
        <dt>Contact email</dt>
        <dd>
          {% if identity.contact_email %}
            {{ identity.contact_email }}
          {% elif contact_restricted %}
            <span class="muted">Visible to administrators only</span>
          {% else %}
            <span class="muted">Not provided</span>
          {% endif %}
        </dd>
      </div>
      <div class="definition-list__row">
        <dt>Member since</dt>
        <dd>{{ identity.created_at.strftime('%b %d, %Y') }}</dd>
      </div>
    </dl>
  </article>

  {% if show_recent_comments %}
    <article class="card stack profile-comments-card">
      <div class="profile-comments-card__header">
        <div>
          <h2>Recent comments</h2>
          <p class="muted small-text">Showing up to {{ recent_comments_limit }} of the latest entries.</p>
        </div>
        <span class="button button--ghost button--disabled" aria-disabled="true">Full history coming soon</span>
      </div>
      {% if recent_comments %}
        <ul class="profile-recent-comments">
          {% for comment in recent_comments %}
            <li class="profile-recent-comment">
              <div class="profile-recent-comment__meta">
                <a href="{{ comment.request_url }}" class="profile-recent-comment__request">
                  Request #{{ comment.request_id }} · {{ comment.request_title or 'Untitled request' }}
                </a>
                {% if comment.created_at %}
                  <time datetime="{{ comment.created_at_iso }}" class="profile-recent-comment__time">{{ comment.created_at | friendly_time }}</time>
                {% endif %}
              </div>
              <p class="profile-recent-comment__body">{{ comment.body }}</p>
              <span class="meta-chip meta-chip--small">{{ comment.scope }}</span>
            </li>
          {% endfor %}
        </ul>
      {% else %}
        <p class="muted">No comments yet.</p>
      {% endif %}
    </article>
  {% endif %}

  <div>
    <a class="button button--ghost" href="/">Back to requests</a>
  </div>
</section>
{% endblock %}
