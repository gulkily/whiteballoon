{% extends "base.html" %}

{% block title %}Request #{{ request_item.id }} · WhiteBalloon{% endblock %}

{% block nav %}
  {% include "partials/account_nav.html" %}
{% endblock %}

{% block content %}
<section class="section">
  <div class="card stack">
    <div class="stack stack--row stack--center">
      <a href="/" class="button button--ghost" aria-label="Back to help requests">← Back to feed</a>
      <h1 class="grow">Request #{{ request_item.id }}</h1>
    </div>
    <div class="share-panel">
      <label for="request-share-url" class="small-text muted">Share this link</label>
      <input
        id="request-share-url"
        type="url"
        value="{{ request.url }}"
        readonly
        data-share-url
      />
    </div>
    {% set item = request_item %}
    {% set show_detail_link = False %}
    <div class="request-detail">
      {% include "requests/partials/item.html" %}
    </div>
  </div>
</section>
<script>
  (function () {
    var field = document.querySelector('[data-share-url]');
    if (!field) {
      return;
    }

    var selectField = function () {
      field.focus();
      field.select();
      try {
        field.setSelectionRange(0, field.value.length);
      } catch (err) {
        /* ignore: unsupported */
      }
    };

    var copyField = function () {
      if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(field.value).catch(function () {
          try {
            document.execCommand('copy');
          } catch (err) {
            /* ignore copy failures */
          }
        });
      } else {
        try {
          document.execCommand('copy');
        } catch (err) {
          /* ignore copy failures */
        }
      }
    };

    field.addEventListener('click', function () {
      selectField();
      copyField();
    });

    field.addEventListener('focus', selectField);
  })();
</script>
{% endblock %}
