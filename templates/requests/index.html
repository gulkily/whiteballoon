{% extends "base.html" %}

{% block title %}Requests Â· WhiteBalloon{% endblock %}

{% block nav %}
  <form action="/logout" method="post" class="inline">
    <button type="submit" class="button button--ghost">Sign out</button>
  </form>
{% endblock %}

{% block content %}
{% set readonly = readonly if readonly is defined else False %}
<section class="section">
  <div
    class="card stack is-collapsed"
    id="request-form-card"
    data-request-card
    data-readonly="{{ 'true' if readonly else 'false' }}"
    data-user-id="{{ user.id }}"
    data-user-username="{{ user.username }}"
  >
    <div class="stack" data-request-collapsed>
      <header class="stack stack--row stack--center">
        <h1 class="grow">Help requests</h1>
        <button type="button" class="button" data-request-action="show-form">Share a request</button>
      </header>
      <p class="muted">View the latest needs below or add a new one.</p>
    </div>

    <form method="post" action="/requests" class="form-grid" data-request-form hidden>
      <div class="input-group">
        <label for="description">How can we help?</label>
        <textarea id="description" name="description" placeholder="Share the need" required></textarea>
      </div>
      <div class="input-group">
        <label for="contact_email">Contact email <span class="muted">(optional)</span></label>
        <input id="contact_email" name="contact_email" type="email" value="{{ user.contact_email or '' }}" />
      </div>
      <div class="actions">
        <button type="submit" class="button">Post request</button>
        <button type="button" class="button button--ghost" data-request-action="cancel-form">Cancel</button>
      </div>
      <div class="muted" data-request-status role="status"></div>
    </form>

    <noscript>
      <style>[data-request-collapsed]{display:none;}</style>
      <form method="post" action="/requests" class="form-grid">
        <div class="input-group">
          <label for="noscript-description">How can we help?</label>
          <textarea id="noscript-description" name="description" placeholder="Share the need" required></textarea>
        </div>
        <div class="input-group">
          <label for="noscript-contact">Contact email <span class="muted">(optional)</span></label>
          <input id="noscript-contact" name="contact_email" type="email" />
        </div>
        <div class="actions">
          <button type="submit" class="button">Post request</button>
        </div>
      </form>
    </noscript>
  </div>

  <div id="request-list" data-request-list data-readonly="{{ 'true' if readonly else 'false' }}">
    {% include "requests/partials/list.html" %}
  </div>
</section>
{% endblock %}
