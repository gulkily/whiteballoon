{% set comment_actions = [] %}
{% set comment_insights_enabled = comment_insights_enabled | default(false) %}
{% set comment_insights_map = comment_insights_map | default({}) %}
{% set can_promote_comments = can_promote_comments | default(false) %}
{% set comment_promotions = comment_promotions | default({}) %}
{% set comment_promotion_entries = comment_promotions.get(comment.id) or [] %}
{% set comment_latest_promotion = comment_promotion_entries[-1] if comment_promotion_entries else none %}
{% if can_toggle_sync_scope %}
  {% set _ = comment_actions.append({
    'label': 'Share' if comment.sync_scope == 'private' else 'Make private',
    'href': '/sync/scope',
    'method': 'POST',
    'type': 'form',
    'form_attributes': {
      'data-comment-scope-form': ''
    },
    'hidden_fields': [
      {'name': 'entity_type', 'value': 'comment'},
      {'name': 'entity_id', 'value': comment.id},
      {'name': 'next', 'value': request.url.path},
      {'name': 'scope', 'value': 'public' if comment.sync_scope == 'private' else 'private'}
    ]
  }) %}
{% endif %}
{% if can_moderate_comments %}
  {% set _ = comment_actions.append({
    'label': 'Delete comment',
    'href': '/requests/' ~ request_id ~ '/comments/' ~ comment.id ~ '/delete',
    'method': 'POST',
    'type': 'form',
    'form_attributes': {
      'data-comment-delete-form': ''
    },
    'attributes': {
      'data-comment-delete': ''
    }
  }) %}
{% endif %}
{% if can_promote_comments %}
  {% set _ = comment_actions.append({
    'label': 'Promote',
    'type': 'button',
    'attributes': {
      'data-comment-promote': '',
      'data-comment-promote-id': comment.id
    }
  }) %}
{% endif %}
{% with actions = comment_actions, variant = 'request', comment_insights_enabled = comment_insights_enabled, comment_insights_map = comment_insights_map, comment_promotion = comment_latest_promotion, comment_promotion_count = comment_promotion_entries | length, comment_permalink_href = '/comments/' ~ comment.id %}
  {% include "partials/comment_card.html" %}
{% endwith %}
