{% set readonly = readonly if readonly is defined else False %}
{% set can_complete = item.can_complete | default(false) %}
{% set creator_username = item.created_by_username | default('') %}
{% set has_creator_link = creator_username != '' %}
{% set creator_name = creator_username if has_creator_link else 'Community member' %}
<article class="request-item">
  <header class="request-meta">
    <div class="request-meta__lead">
      {% if has_creator_link %}
        <a class="request-creator" href="/people/{{ creator_username }}" title="View {{ creator_name }}'s profile">{{ creator_name }}</a>
      {% else %}
        <span class="request-creator" title="{{ creator_name }}">{{ creator_name }}</span>
      {% endif %}
      <span class="badge{% if item.status == 'completed' %} badge--completed{% endif %}">
        {{ item.status|title }}
      </span>
    </div>
    <time datetime="{{ item.created_at }}" class="muted">{{ item.created_at | replace('T', ' ') | replace('Z', '') }}</time>
  </header>
  <div>
    <p>{{ item.description or 'No additional details.' }}</p>
  </div>
  <footer class="actions">
    {% if not readonly and item.status != 'completed' and can_complete %}
      <form method='post' action='/requests/{{ item.id }}/complete' data-request-complete data-request-id='{{ item.id }}' class='inline'>
        <button type='submit' class='button'>Mark completed</button>
      </form>
    {% elif item.status == 'completed' %}
      <span class="muted">Completed {{ item.completed_at | default('recently') | replace('T', ' ') | replace('Z', '') }}</span>
    {% endif %}
    {% if item.contact_email %}
      <span class='muted'>Contact: {{ item.contact_email }}</span>
    {% endif %}
  </footer>
</article>
