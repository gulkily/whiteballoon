{% set readonly = readonly if readonly is defined else False %}
{% set can_complete = item.can_complete | default(false) %}
{% set creator_username = item.created_by_username | default('') %}
{% set has_creator_link = creator_username != '' %}
{% set creator_name = creator_username if has_creator_link else 'Community member' %}
{% set request_icon = 'âœ¨' if item.status != 'completed' else 'ğŸ’«' %}
{% set show_detail_link = show_detail_link if show_detail_link is defined else True %}
<article class="request-item">
  <header class="request-meta">
    <div class="request-meta__lead">
      {% if has_creator_link %}
        <a class="request-creator" href="/people/{{ creator_username }}" title="View {{ creator_name }}'s profile">{{ request_icon }} {{ creator_name }}</a>
      {% else %}
        <span class="request-creator" title="{{ creator_name }}">{{ request_icon }} {{ creator_name }}</span>
      {% endif %}
      <span class="badge{% if item.status == 'completed' %} badge--completed{% endif %}">
        {{ item.status|title }}
      </span>
    </div>
    <time datetime="{{ item.created_at }}" title="{{ item.created_at }}" class="muted">{{ item.created_at | friendly_time }}</time>
  </header>
  <div>
    <p>{{ item.description or 'No additional details.' }}</p>
  </div>
  <footer class="actions">
    {% if show_detail_link %}
      <a class="button button--ghost" href="/requests/{{ item.id }}">View details</a>
    {% endif %}
    {% if not readonly and item.status != 'completed' and can_complete %}
      <form method='post' action='/requests/{{ item.id }}/complete' data-request-complete data-request-id='{{ item.id }}' class='inline'>
        <button type='submit' class='button'>Mark completed</button>
      </form>
    {% elif item.status == 'completed' %}
      <span class="muted"{% if item.completed_at %} title="{{ item.completed_at }}"{% endif %}>Completed {{ item.completed_at | friendly_time or 'recently' }}</span>
    {% endif %}
    {% if item.contact_email %}
      <span class='muted'>Contact: {{ item.contact_email }}</span>
    {% endif %}
  </footer>
</article>
