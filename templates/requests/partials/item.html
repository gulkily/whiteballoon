{% set readonly = readonly if readonly is defined else False %}
{% set can_complete = item.can_complete | default(false) %}
{% set creator_username = item.created_by_username | default('') %}
{% set has_creator_link = creator_username != '' %}
{% set creator_name = creator_username if has_creator_link else 'Community member' %}
{% set request_icon = 'âœ¨' if item.status != 'completed' else 'ğŸ’«' %}
{% set show_detail_link = show_detail_link if show_detail_link is defined else True %}
{% set requester_value = request_icon ~ ' ' ~ (creator_username if has_creator_link else creator_name) %}
<article class="request-item">
  <header class="request-meta">
    <div class="request-meta__chips">
      <span class="meta-chip meta-chip--requester">
        <span class="meta-chip__label">Requester</span>
        {% if has_creator_link %}
          <a class="meta-chip__value meta-chip__value--link" href="/people/{{ creator_username }}" title="View {{ creator_name }}'s profile">{{ requester_value }}</a>
        {% else %}
          <span class="meta-chip__value">{{ requester_value }}</span>
        {% endif %}
      </span>
      <span class="meta-chip meta-chip--status">
        <span class="meta-chip__label">Status</span>
        <span class="meta-chip__value">{{ item.status|title }}</span>
      </span>
      {% if show_detail_link %}
        <a class="meta-chip meta-chip--timestamp" href="/requests/{{ item.id }}" title="View request details">
          <span class="meta-chip__label">Updated</span>
          <time class="meta-chip__value" datetime="{{ item.created_at }}">{{ item.created_at | friendly_time }}</time>
        </a>
      {% else %}
        <span class="meta-chip meta-chip--timestamp">
          <span class="meta-chip__label">Updated</span>
          <time class="meta-chip__value" datetime="{{ item.created_at }}">{{ item.created_at | friendly_time }}</time>
        </span>
      {% endif %}
    </div>
  </header>
  <div>
    <p>{{ item.description or 'No additional details.' }}</p>
  </div>
  <footer class="actions">
    {% if not readonly and item.status != 'completed' and can_complete %}
      <form method='post' action='/requests/{{ item.id }}/complete' data-request-complete data-request-id='{{ item.id }}' class='inline'>
        <button type='submit' class='button'>Mark completed</button>
      </form>
    {% elif item.status == 'completed' %}
      <span class="muted"{% if item.completed_at %} title="{{ item.completed_at }}"{% endif %}>Completed {{ item.completed_at | friendly_time or 'recently' }}</span>
    {% endif %}
    {% if item.contact_email %}
      <span class='muted'>Contact: {{ item.contact_email }}</span>
    {% endif %}
  </footer>
</article>
