{% extends "base.html" %}

{% block title %}Pending Approval Â· WhiteBalloon{% endblock %}

{% block nav %}
  <form action="/logout" method="post" class="inline">
    <button type="submit" class="button button--ghost">Sign out</button>
  </form>
{% endblock %}

{% block content %}
<section class="section" data-pending-dashboard>
  <div class="card stack">
    <h1>Waiting for approval</h1>
    <p class="muted">Your access request is pending. You can browse existing requests while an administrator approves you.</p>
    {% if verification_code %}
      <div class="alert">Verification code: <strong>{{ verification_code }}</strong></div>
    {% else %}
      <div class="muted">No active verification code was found. Request access again if needed.</div>
    {% endif %}
    <p class="muted">Any drafts you create stay private until your account is fully approved.</p>
  </div>

  <div
    class="card stack is-collapsed"
    data-request-card
    data-readonly="true"
    data-user-id="{{ user.id }}"
    data-user-username="{{ user.username }}"
  >
    <div class="stack" data-request-collapsed>
      <header class="stack stack--row stack--center">
        <h2 class="grow">Draft a request</h2>
        <button type="button" class="button" data-request-action="show-form">Open draft</button>
      </header>
      <p class="muted">Drafts remain private until an admin approves you.</p>
    </div>

    <form method="post" action="/requests" class="form-grid" data-request-form hidden>
      <div class="input-group">
        <label for="pending-description">How can we help?</label>
        <textarea id="pending-description" name="description" placeholder="Share the need" required></textarea>
      </div>
      <div class="input-group">
        <label for="pending-contact">Contact email <span class="muted">(optional)</span></label>
        <input id="pending-contact" name="contact_email" type="email" value="{{ user.contact_email or '' }}" />
      </div>
      <div class="actions">
        <button type="submit" class="button">Save draft</button>
        <button type="button" class="button button--ghost" data-request-action="cancel-form">Cancel</button>
      </div>
      <div class="muted" data-request-status role="status"></div>
    </form>

    <noscript>
      <p class="muted">Enable JavaScript to keep a draft while you wait for approval.</p>
    </noscript>
  </div>

  {% if pending_requests %}
  <div class="card stack">
    <h2>Your pending requests</h2>
    <div class="requests-grid">
      {% for item in pending_requests %}
        {% set readonly = True %}
        {% include "requests/partials/item.html" %}
      {% endfor %}
    </div>
    <p class="muted">These will publish automatically once you are approved.</p>
  </div>
  {% endif %}

  <div class="card stack">
    <h2>Community requests</h2>
    <div id="request-list" data-request-list data-readonly="true">
      {% set readonly = True %}
      {% include "requests/partials/list.html" %}
    </div>
  </div>
</section>
{% endblock %}
