#!/usr/bin/env bash
set -euo pipefail

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

log() {
  printf '\033[0;34m[INFO]\033[0m %s\n' "$1"
}

warn() {
  printf '\033[1;33m[WARN]\033[0m %s\n' "$1"
}

fail() {
  printf '\033[0;31m[ERROR]\033[0m %s\n' "$1" >&2
  exit 1
}

python_exec() {
  # Try Python 3.10+ versions first (common on macOS with Homebrew)
  for version in python3.13 python3.12 python3.11 python3.10; do
    if command -v "$version" >/dev/null 2>&1; then
      if "$version" -c "import sys; exit(0 if sys.version_info >= (3, 10) else 1)" 2>/dev/null; then
        echo "$(command -v "$version")"
        return
      fi
    fi
  done
  # Fall back to python3 or python
  if command -v python3 >/dev/null 2>&1; then
    if python3 -c "import sys; exit(0 if sys.version_info >= (3, 10) else 1)" 2>/dev/null; then
      echo "$(command -v python3)"
      return
    fi
  fi
  if command -v python >/dev/null 2>&1; then
    if python -c "import sys; exit(0 if sys.version_info >= (3, 10) else 1)" 2>/dev/null; then
      echo "$(command -v python)"
      return
    fi
  fi
  fail "Python 3.10+ is required. Please install it and re-run."
}

# Delegate to the unified Python launcher
if [ -f "$SCRIPT_DIR/wb.py" ]; then
  py="$(python_exec)"
  exec "$py" "$SCRIPT_DIR/wb.py" "$@"
fi

fail "wb.py not found. Ensure you're running from the project root."
